# 2025-01-22 認証システム実装

## 実施内容

### 1. JWT認証の基盤構築

#### JWTユーティリティ (`utils/jwt.ts`)
- トークン生成機能
- トークン検証機能
- エラーハンドリング（期限切れ、無効なトークン）
- 環境変数による設定（秘密鍵、有効期限）

#### パスワード処理 (`utils/password.ts`)
- bcryptによるハッシュ化（ソルトラウンド: 10）
- パスワード検証機能

### 2. 認証ミドルウェア (`middlewares/auth.ts`)
- Bearerトークンの抽出
- トークン検証
- リクエストオブジェクトへのユーザー情報付与
- エラーハンドリング

### 3. 認証APIエンドポイント (`controllers/authController.ts`)

#### 公開エンドポイント
- `POST /api/auth/register` - 新規登録
  - メールアドレス重複チェック
  - パスワード強度検証（8文字以上）
  - JWTトークン発行
  
- `POST /api/auth/login` - ログイン
  - メールアドレス/パスワード認証
  - JWTトークン発行

#### 認証必要エンドポイント
- `GET /api/auth/me` - 現在のユーザー情報取得
  - 投稿した授業実践数を含む
  
- `PUT /api/auth/profile` - プロフィール更新
  - 名前、自己紹介、専門分野、連絡受付設定

### 4. 既存APIの保護
- 授業実践の作成、更新、削除に認証ミドルウェアを適用
- 認証ユーザーのみがCRUD操作可能に

## セキュリティ対策
- パスワードのハッシュ化（bcrypt）
- JWTトークンによるステートレス認証
- トークン有効期限の設定（デフォルト7日）
- パスワードをレスポンスから除外

## APIエンドポイント一覧
```
認証関連:
POST   /api/auth/register     - 新規登録
POST   /api/auth/login        - ログイン
GET    /api/auth/me           - 現在のユーザー情報
PUT    /api/auth/profile      - プロフィール更新

授業実践関連:
GET    /api/practices         - 一覧取得（公開）
GET    /api/practices/:id     - 個別取得（公開）
POST   /api/practices         - 新規作成（要認証）
PUT    /api/practices/:id     - 更新（要認証）
DELETE /api/practices/:id     - 削除（要認証）
```

## 次のステップ
- 連絡フォーム機能の実装
- ファイルアップロード機能
- フロントエンドの実装開始